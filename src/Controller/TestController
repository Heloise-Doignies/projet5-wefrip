<?php 
//Test unitaire de connexion
use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class AuthenticationTest extends WebTestCase
{
    public function testSuccessLogin()
    {
        $client = static::createClient();

        $email = 'user@user.com';
        $password = 'password123?';

        $crawler = $client->request('GET', '/login'); 

        $form = $crawler->selectButton('Se connecter')->form([
            'email' => $email,
            'password' => $password,
        ]);

        $client->submit($form);

        //Redirection vers la page d'accueil après la connexion
        $this->assertResponseRedirects('/profil');

        // Message de succès après la connexion
        $this->assertSelectorTextContains('.flash-success', 'Connecté avec succès');

        // Vérifier l'état de l'authentification
        $this->assertTrue($client->getContainer()->get('security.authorization_checker')->isGranted('ROLE_USER'));
    }
}
